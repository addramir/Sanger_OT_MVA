#sigma_cond=S[response,response]-t(.b(response,pred,S=S))%*%S[response,pred]-.cond_b(response,pred,cond,S)
#sigma_joint=S[response,response]
sigma_joint=(S[response,response]-t(.b(response,pred=cond,S=S))%*%S[response,cond])
sigma_joint=sigma_joint-t(.cond_b(response,pred,cond,S))%*%S[response,pred]
out=as.vector(sigma_joint)*solve(S[pred,pred])/(N-length(pred)-1)
out=diag(out)
out=sqrt(out)
return(out)
}
.cond_se(response=1,pred=3,cond=2,S=S,N=10000)
.b=function(response,pred,S){
out <- solve(S[pred,pred])%*%S[response,pred]
return(out)
}
.seb=function(response,pred,S,N){
sigma_joint=(S[response,response]-t(.b(response,pred,S=S))%*%S[response,pred])
#sigma_joint=S[response,response]
out=as.vector(sigma_joint)*solve(S[pred,pred])/(N-length(pred)-1)
out=diag(out)
out=sqrt(out)
return(out)
}
#
.manova=function(response,pred,S,N){
sigma_joint=(S[response,response]-t(.b(response,pred,S=S))%*%S[response,pred])
Fst=((S[response,response]-as.vector(sigma_joint))/as.vector(sigma_joint))*((N-length(pred)-1)/length(pred))
return(Fst)
}
.t=function(response,pred,S,N){
out=.b(response=response,pred=pred,S=S)/.seb(response=response,pred=pred,S=S,N=N)
return(out)
}
.cond_b=function(response,pred,cond,S){
b_pred=S[response,pred]/S[pred,pred]
b_cond=.b(response=response,pred=cond,S=S)
b_pred=b_pred-sum(S[pred,cond]*b_cond)/S[pred,pred]
b_pred
}
.cond_se=function(response,pred,cond,S,N){
#sigma_cond=S[response,response]-t(.b(response,pred,S=S))%*%S[response,pred]-.cond_b(response,pred,cond,S)
#sigma_joint=S[response,response]
sigma_joint=(S[response,response]-t(.b(response,pred=cond,S=S))%*%S[response,cond])
sigma_joint=sigma_joint-t(.cond_b(response,pred,cond,S))%*%S[response,pred]
out=as.vector(sigma_joint)*solve(S[pred,pred])/(N-length(pred)-1)
out=diag(out)
out=sqrt(out)
return(out)
}
.cond_se(response=1,pred=3,cond=2,S=S,N=10000)
summary(lm(res~g))
N=10000
g1=sample(rbinom(N,0:2,0.5))
g2=g1*0.1+rnorm(N)
y=g1*0.05-0.3*g2+rnorm(N)
b1=lm(y~g1)$coeff[2]
b2=lm(y~g2)$coeff[2]
b1=lm(y~g1)$coeff[2]
b2=lm(y~g2)$coeff[2]
covg=cov(g1,g2)
b1
b2
cov(g1,g2)
S=matrix(0,c(3,3))
S=matrix(0,c(3,3))
colnames(S)=rownames(S)=c("g1","g2","y")
S
S=array(0,c(3,3))
colnames(S)=rownames(S)=c("g1","g2","y")
S
S=array(0,c(3,3))
colnames(S)=rownames(S)=c("g1","g2","y")
S["g1","g1"]=var(g1)
S["g2","g2"]=var(g2)
S["y","y"]=var(y)
S["g1","g2"]=cov(g1,g2)
S["y","g1"]=b1*var(g1)
S["y","g2"]=b2*var(g2)
S[lower.tri(S)]=t(S)[lower.tri(S)]
S
S=array(0,c(3,3))
colnames(S)=rownames(S)=c("g1","g2","y")
S["g1","g1"]=var(g1)
S["g2","g2"]=var(g2)
S["y","y"]=var(y)
S["g1","g2"]=cov(g1,g2)
S["g1","y"]=b1*var(g1)
S["g2","y"]=b2*var(g2)
S[lower.tri(S)]=t(S)[lower.tri(S)]
S
var(cbind(g1,g2,y))
summary(lm(y~g1+g2))
.b(response = 3,pred=1:2,S=S)
.seb(response = 3,pred=1:2,S=S,N=N)
# conditional b1 | b2
res=lm(y~g2)$residuals
summary(lm(res~g1))
b1
.b(response = 3,pred=1:2,S=S)
summary(lm(res~g1))
.cond_b(response=3,pred=1,cond=2,S=S)
summary(lm(res~g1))
.cond_b(response=3,pred=1,cond=2,S=S)
.cond_se(response=3,pred=1,cond=2,S=S,N=N)
.cond_b(response=3,pred=1,cond=2,S=S)
.cond_se(response=3,pred=1,cond=2,S=S,N=N)
qchisq(5e-8,df=1,low=F)
y
sqrt(20)
pchisq(10-6,df=1,low=F)
qchisq(10-6,df=1,low=F)
qchisq(1e-6,df=1,low=F)
sqrt(qchisq(1e-6,df=1,low=F))
setwd("Projects/Sanger_OT_MVA/06_PD_fm/")
library(data.table)
full=fread("nall_l2gs_v1.csv")
View(full)
th=fread("nalls_l2g_predictions_270423.csv")
View(th)
table(full$gene_id%in%th$gene_id)
ind=whcih(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
ind=match(full$gene_id,th$gene_id)
table(th$gene_id==full$gene_id)
th=th[ind,]
table(th$gene_id==full$gene_id)
table(is.na(full$y_proba_full_model))
plot(y=full$y_proba_full_model,x=th$y_proba)
abline(b=1)
abline(a=1)
abline(b=1,a=0)
full=full[!(is.na(full$y_proba_full_model)),]
table(is.na(full$y_proba_full_model))
ind=match(full$gene_id,th$gene_id)
th=th[ind,]
table(th$gene_id==full$gene_id)
plot(y=full$y_proba_full_model,x=th$y_proba)
abline(b=1,a=0)
cor(full$y_proba_full_model,th$y_proba)
lm(full$y_proba_full_model~th$y_proba)
summary(lm(full$y_proba_full_model~th$y_proba))
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
plot(y=full$y_proba_full_model,x=th$y_proba,xlab="top hits",ylab="gwas")
plot(y=full$y_proba_full_model,x=th$y_proba,xlab="top hits",ylab="gwas")
plot(y=full$y_proba_full_model,x=th$y_proba,xlab="top hits",ylab="pd gwas")
abline(b=1,a=0)
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
setwd("Projects/Sanger_OT_MVA/06_PD_fm/")
setwd("projects/Sanger_OT_MVA/06_PD_fm/")
library(data.table)
full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
#full=fread("nall_l2gs_v1.csv")
full=fread("nall_l2gs_v1.csv")
View(full)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
View(full)
th=fread("nalls_l2g_predictions_270423.csv")
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
full=full[!(is.na(full$y_proba_full_model)),]
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
table(duplicates(full$gene_id))
table(duplicated(full$gene_id))
dup_ids=full$gene_id[duplicated(full$gene_id)]
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids)[
ind=which(full$gene_id==id)
which.max(full$y_proba_full_model[ind])
full$y_proba_full_model[ind]
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind_max
ind=ind[-ind_max]
ind
full$y_proba_full_model[ind]
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
unique(full$gene_id[duplicated(full$gene_id)])
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
th=fread("nalls_l2g_predictions_270423.csv")
table(full$gene_id%in%th$gene_id)
th
table(is.na(th$y_pred))
#####
th=fread("nalls_l2g_predictions_270423.csv")
dup_ids=unique(full$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
dup_ids=unique(full$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind
View(th)
th$y_proba[ind]
ind_max=which.max(th$y_proba[ind])
ind_max
ind=ind[-ind_max]
ind
#####
th=fread("nalls_l2g_predictions_270423.csv")
dup_ids=unique(full$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
dup_ids=unique(full$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
ind=match(full$gene_id,th$gene_id)
th=th[ind,]
table(th$gene_id==full$gene_id)
table(is.na(full$y_proba_full_model))
plot(y=full$y_proba_full_model,x=th$y_proba,xlab="top hits",ylab="pd gwas")
abline(b=1,a=0)
cor(full$y_proba_full_model,th$y_proba)
summary(lm(full$y_proba_full_model~th$y_proba))
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
length(unique(full$pos))
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
length(unique(full$pos))
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
length(unique(full$pos))
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
length(unique(full$pos))
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
length(unique(full$pos))
length(unique(full$gene_id))
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
full_05=full[full$y_proba_full_model>0.5]
View(full_05)
length(unique(full$gene_id))
_05
length(unique(full_05$gene_id))
length(unique(full_05$pos))
14/25
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
full_05=full[full$y_proba_full_model>0.5]
length(unique(full_05$gene_id))
length(unique(full_05$pos))
length(unique(full$pos))
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
length(unique(th$pos))
length(unique(gene_id$pos))
length(unique(th$gene_id))
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
full_05=full[full$y_proba_full_model>=0.5]
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
length(unique(th$pos))
length(unique(th$gene_id))
th_05=th[th$y_proba>=0.5,]
length(unique(th_05$gene_id))
th_05=th[th$y_proba>=0.5,]
length(unique(th_05$gene_id))
length(unique(th_05$pos))
62/107
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
length(unique(th$pos))
length(unique(th$gene_id))
th_05=th[th$y_proba>=0.5,]
length(unique(th_05$gene_id))
length(unique(th_05$pos))
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
table(full$gene_id%in%th$gene_id)
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
full_05=full[full$y_proba_full_model>=0.5]
length(unique(full_05$gene_id))
length(unique(full_05$pos))
length(unique(full$pos))
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
length(unique(th$pos))
length(unique(th$gene_id))
th_05=th[th$y_proba>=0.5,]
length(unique(th_05$gene_id))
length(unique(th_05$pos))
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
table(full$gene_id%in%th$gene_id)
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
length(unique(full$pos))
setwd("Projects/Sanger_OT_MVA/06_PD_fm/")
library(data.table)
#full=fread("nall_l2gs_v1.csv")
full=fread("nalls_l2g_table.csv")
dim(full)
full=full[!(is.na(full$y_proba_full_model)),]
full_05=full[full$y_proba_full_model>=0.5]
length(unique(full_05$gene_id))
length(unique(full_05$pos))
length(unique(full$pos))
dup_ids=unique(full$gene_id[duplicated(full$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(full$gene_id==id)
ind_max=which.max(full$y_proba_full_model[ind])
ind=ind[-ind_max]
full=full[-ind,]
}
#####
th=fread("nalls_l2g_predictions_270423.csv",data.table=F)
length(unique(th$pos))
length(unique(th$gene_id))
th_05=th[th$y_proba>=0.5,]
length(unique(th_05$gene_id))
length(unique(th_05$pos))
dup_ids=unique(th$gene_id[duplicated(th$gene_id)])
id=dup_ids[1]
for (id in dup_ids){
ind=which(th$gene_id==id)
ind_max=which.max(th$y_proba[ind])
ind=ind[-ind_max]
th=th[-ind,]
}
table(full$gene_id%in%th$gene_id)
ind=which(full$gene_id%in%th$gene_id)
full=full[ind,]
length(unique(full$pos))
ind=match(full$gene_id,th$gene_id)
th=th[ind,]
table(th$gene_id==full$gene_id)
table(is.na(full$y_proba_full_model))
plot(y=full$y_proba_full_model,x=th$y_proba,xlab="top hits",ylab="pd gwas")
abline(b=1,a=0)
cor(full$y_proba_full_model,th$y_proba)
summary(lm(full$y_proba_full_model~th$y_proba))
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
table(unqiue(full$gene_id))
length(unqiue(full$gene_id))
length(unique(full$gene_id))
table(full$y_proba_full_model>0.5)
table(th$y_proba>0.5)
table(full$y_proba_full_model>=0.5)
table(th$y_proba>=0.5)
ind1=which(full$y_proba_full_model>=0.5)
ind2=which(th$y_proba>=0.5)
ind1=which(full$y_proba_full_model>=0.5)
ind2=which(th$y_proba>=0.5)
length(intersect(ind1,ind2))
ind=unique(c(ind1,ind2))
ind
length(ind)
plot(y=full$y_proba_full_model[ind],x=th$y_proba[ind],xlab="top hits",ylab="pd gwas")
abline(b=1,a=0)
ind
ind1
ind1[ind1%in%ind2]
ind1[!ind1%in%ind2]
full[ind1[!ind1%in%ind2],]
